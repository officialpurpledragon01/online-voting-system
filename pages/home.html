<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vote</title>
  <link rel="stylesheet" href="../css/general.css">
  <link rel="stylesheet" href="../css/header.css">
  <link rel="stylesheet" href="../css/nav.css">
</head>
<body>
  <header>
    <nav>
      <div class="left-nav">
        Logo
      </div>
      <div class="right-nav">
        user abstract
      </div>
    </nav>
  </header>
  <section>
    <nav class="side-nav">
      <div class="campaign"> 
        Ongoing Campaign
      </div>
      <div class="profile"> 
        My Profile
      </div>
      <div class="logout"> 
        Log Out
      </div>
    </nav>
    <main>
      <div class="form">
        GO ON VOTE
        <button class='vote' onclick="vote()">VOTE</button>
        <br> <br>
        <p style="border: 2px saddlebrown solid;">
          <a href="profile.html">Profile</a> || 
          <a href="../index.html"> Home </a> || 
          <a href="../preview/preview.html">Preview Page</a> ||
          <a href="../proto/index.html">Progress</a>
        </p>
      </div>
    </main>
  </section>

  <script>
   const currentUser = JSON.parse(
      localStorage.getItem('currentUser')
    );
    const users = JSON.parse(
      localStorage.getItem('users')
    );

    const userId = currentUser.userId
    const userVote = currentUser.status.voted;
    let isVote = userVote

    const voteBtn = document.querySelector('.vote')

    function vote() {
      if (!isVote){
        voteBtn.innerText = 'VOTED'
        currentUser.status.voted = true
        isVote = true

        localStorage.setItem('currentUser', JSON.stringify(currentUser))
        alert('voted success');

        users.forEach(user => {
          if (user.userId == userId) {
            user.status.voted = currentUser.status.voted
            localStorage.setItem('users', JSON.stringify(users))
            console.log('vote updated')            
          }
        });

      } else {
        alert('You already voted')
        console.log(userVote)
      }
    }

  </script>
</body>
</html>