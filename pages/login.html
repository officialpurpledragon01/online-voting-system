<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Log In</title>
  <link rel="stylesheet" href="/css/general.css">
  <link rel="stylesheet" href="/css/header.css">
  <!-- <link rel="stylesheet" href="/css/login.css"> -->
  <link rel="stylesheet" href="/css/signup.css">
</head>
<body>
  <header>
    <nav>
      <div class="left-nav">
        Logo
      </div>
      <div class="right-nav">
        Menu
      </div>
    </nav>
  </header>
  <main>
    <div class="form-container">
      <div class="title"> LOG IN/SIGN IN</div>
      <div class="form">
        <label for="matric"> Matric/Reg No:
          <input type="text" class="regNo">
        </label>
        <label for="password"> Password:
          <input type="password" class="password">
        </label>
        <button class="login">LOG IN</button>
      </div>
      <div class="redirector">
        Have no account yet? <a href="signup.html">Create one</a>
      </div>
    </div>
  </main>

  <script>
    let userinfo = JSON.parse(localStorage.getItem('users'))
    const loginBtn = document.querySelector('.login')

    function login(){
      let regNo = document.querySelector('.regNo').value.trim().toUpperCase();
      let pascode = document.querySelector('.password').value.trim();

      if(!regNo || !pascode){
        alert('all fields are required')
        console.log('all fields are required');
        return;
      }

      let matched = false;

      userinfo.forEach((user, index) => {
        if (regNo === user.matric && pascode=== user.password){
          matched = true;
          let currentUser = user;
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          let userId = index;
          localStorage.setItem('userIndex_Id', JSON.stringify(userId));
        }  
      });
      
      if (matched){
        console.log('matched success')
        loginBtn.innerHTML = 'LOGGING IN...'
        setTimeout(()=>{
          // loginBtn.innerHTML = 'LOG IN'
          window.location.href = '../pages/profile.html';
        }, 2500)
      } else {
        loginBtn.innerHTML = 'LOGGING IN...'
        setTimeout(()=>{
          loginBtn.innerHTML = 'LOG IN'
          alert('User not found')
        }, 1500)
        console.log('User Not Found')
        // loginBtn.setAttributeNS = 'disabled'
        // console.log(loginBtn)
      }
    }

   loginBtn.addEventListener('click',()=>{
    login()
   });
  </script>
</body>
</html>